<!doctype html>
<html lang="ja">
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <!-- Manifest -->
  <link rel="manifest" href="manifest.json">
  <!-- Splash screen -->
  <link rel="apple-touch-icon" href="icons/icon-72x72.png" sizes="72x72">
  <link rel="apple-touch-icon" href="icons/icon-114x114.png" sizes="114x114">
  <link rel="apple-touch-icon" href="icons/icon-120x120.png" sizes="120x120">
  <link rel="apple-touch-icon" href="icons/icon-144x144.png" sizes="144x144">
  <link rel="apple-touch-startup-image" href="/public/splash/launch-640x1136.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait) " />
  <link rel="apple-touch-startup-image" href="/public/splash/launch-750x1334.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" />
  <link rel="apple-touch-startup-image" href="/public/splash/launch-1125x2436.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" />
  <link rel="apple-touch-startup-image" href="/public/splash/launch-1242x2208.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" />

  <link href="splashscreens/iphone5_splash.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
  <link href="splashscreens/iphone6_splash.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
  <link href="splashscreens/iphoneplus_splash.png" media="(device-width: 621px) and (device-height: 1104px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image" />
  <link href="splashscreens/iphonex_splash.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image" />
  <link href="splashscreens/iphonexr_splash.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
  <link href="splashscreens/iphonexsmax_splash.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image" />
  <link href="splashscreens/ipad_splash.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
  <link href="splashscreens/ipadpro1_splash.png" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
  <link href="splashscreens/ipadpro3_splash.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
  <link href="splashscreens/ipadpro2_splash.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

  <title>Harumi Example</title>
  <style type="text/css">
    @font-face {
      font-family: "Genkai";
      src: url("./fonts/genkai-sub.woff2") format('woff2'),
      url("./fonts/genkai-sub.woff") format('woff');
    }
    .genkai {
      font-family: "Genkai";
    }
    html,
    body {
      height: 100%;
      padding: 0;
      margin: 0;
    }
  </style>
</head>
<body>
<h1 class="display-3"><span class="genkai">春海</span>: 年号推定フォーム</h1>
<span class="lead">Ver. 0.0.2</span>
<div class="mb-3">
  <label for="era_text" class="lead">元号、干支、年数字文字列</label>
  <input type="text" class="form-control" id="era_text" placeholder="例: 應廿寅">
</div>
<div class="mb-3">
  <label for="era_start" class="lead">期間指定(西暦)</label>
  <div class="row">
    <div class="col-auto">
      <input type="text" class="form-control" id="era_start" placeholder="Start">
    </div>
    <div class="col-auto">
      ～
    </div>
    <div class="col-auto">
      <input type="text" class="form-control" id="era_end" placeholder="End">
    </div>
  </div>
</div>
<div class="mb-3 row">
  <div class="col-auto">
    <input type="checkbox" class="form-check-input" id="era_over_match">
  </div>
  <div class="col-auto">
    <label for="era_over_match" class="lead">延長マッチ(2年固定)</label>
  </div>
</div>
<div class="mb-3 row">
  <div class="col-auto">
    <input type="checkbox" class="form-check-input" id="tsuchinoe_inu">
  </div>
  <div class="col-auto">
    <label for="tsuchinoe_inu" class="lead">戊と戌を見分けない</label>
  </div>
</div>
<div class="mb-3 row">
  <div class="col-auto">
    <input type="checkbox" class="form-check-input" id="tsuchinoto_mi">
  </div>
  <div class="col-auto">
    <label for="tsuchinoto_mi" class="lead">己と巳を見分けない</label>
  </div>
</div>
<div class="mb-3 row">
  <div class="col-auto">
    <button type="submit" class="btn btn-primary mb-3" id="do_search">検索</button>
  </div>
</div>
<ul class="list-group" id="lists"></ul>
<div class="mb-3 row float-end">
  <div class="col-auto">
    ©<span class="genkai">Code for History️</span>
  </div>
</div>
<script src="https://unpkg.com/harumi@0.0.2/dist/harumi.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script>
  window.addEventListener('load', function () {
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register("sw.js")
        .then(function (registration) {
          console.log("sw registed.");
        }).catch(function (error) {
        console.warn("sw error.", error);
      });
    }
  });
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelector("#do_search").addEventListener("click", () => {
      const era_text = document.querySelector("#era_text").value;
      if (era_text === "") {
        alert("年号を推定する文字列を入力してください");
        return;
      }
      const options = {};
      const era_start = document.querySelector("#era_start").value;
      const era_end = document.querySelector("#era_end").value;
      if (era_start !== '' || era_end !== '') {
        options.range = `${era_start}-${era_end}`;
      }
      options.enable_over_match = document.querySelector("#era_over_match").checked;
      options.tsuchinoe_inu_flag = document.querySelector("#tsuchinoe_inu").checked;
      options.tsuchinoto_mi_flag = document.querySelector("#tsuchinoto_mi").checked;
      const results = Harumi.ambiguousSearch(era_text, options);
      if (results.length === 0) {
        results.push({nengo: "結果なし"});
      }
      document.querySelector("#lists").innerHTML = results.reduce((prev, curr) => {
        prev = `${prev}<li class="list-group-item"><span class="display-5">${curr.nengo}</span> <span class="lead">
          ${curr.eto ? `干支: ${curr.eto}` : ''} ${curr.year ? `西暦: ${curr.year}年` : ''}</span>
          ${curr.condition ? `${curr.condition}の年号` : ''} ${curr.over_match ? '延長マッチ' : ''}</li>`;
        return prev;
      }, "");
    });
  });
</script>
</body>
</html>